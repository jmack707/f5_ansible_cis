{
  "$schema": "https://raw.githubusercontent.com/F5Networks/f5-appsvcs-extension/master/schema/latest/as3-schema.json",
  "class": "AS3",
  "declaration": {
      "class": "ADC",
      "schemaVersion": "3.37.0",
      "remark": "CIS AS3",
      "Common": {
          "class": "Tenant",
          "Shared": {
              "class": "Application",
              "template": "shared",
              "Proxy_Protocol_iRule": {
                  "class": "iRule",
                  "iRule": {
                      "base64": "#PROXY Protocol Receiver iRule
# iRule used for F5 IngressLink
# Layer 4 irule since BIG-IP is passthrough
when CLIENT_ACCEPTED {
    set proxyheader "PROXY "
    if {[IP::version] eq 4} {
        append proxyheader "TCP4 "
    } else {
        append proxyheader "TCP6 "
    }
    append proxyheader "[IP::remote_addr] [IP::local_addr] [TCP::remote_port] [TCP::local_port]\r\n"
}
when SERVER_CONNECTED {
    TCP::respond $proxyheader
}=="
                  }
              },
            "dns.listener.53": {
                "layer4": "udp",
                "translateServerAddress": false,
                "translateServerPort": false,
                "class": "Service_UDP",
                "profileDNS": {
                    "bigip": "/Common/dns"
                },
                "profileUDP": {
                    "bigip": "/Common/udp_gtm_dns"
                },
                "virtualAddresses": [
                    "10.1.20.53"
                ],
                "virtualPort": 53,
                "snat": "none",
                "allowVlans": [
                    {
                        "bigip": "/Common/internal"
                    }
                ]
            },
            "DC1": {
                "class": "GSLB_Data_Center"
            },
            "bigip1": {
                "class": "GSLB_Server",
                "dataCenter": {
                    "use": "DC1"
                },
                "devices": [
                    {
                        "address": "10.1.20.4"
                    }
                ],
                "virtualServerDiscoveryMode": "enabled",
                "exposeRouteDomainsEnabled": true
            }
          }
      }
  }
}

